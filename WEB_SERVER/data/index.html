<!DOCTYPE html>
<html>

    <head>
        <title>web app</title>
        <link rel="stylesheet" href="style.css">
    </head>

    <body>
        
        <!--firsrbar -->
        <div class="header flex_row">
            <!-- account -->
         <div class="account flex_column center">
            <div class="profile"></div>
            <h2>Ali478qwe</h2>
         </div>
         <!-- setting -->
          <div class="setting flex_column center">
           <div  class="setting_icon"></div>
           <h2>SETTING</h2>
          </div>
        </div>
        <!--item box -->
        <div class="item_box center flex_row">
            <div class="item flex_column center">
                <div class="item_title_bar flex_row center">
                    <img class="icon" src="icon/thermometer.png">
                    <h2>Temp Oil</h2>
                </div>
                <div class="count_bar flex_row center">
                <h1 id="temp_oil">50</h1>
                <h3>.c</h3>
            </div>
            </div>
            <div class="item flex_column center">
                <div class="item_title_bar flex_row center">
                    <img class="icon" src="icon/coolant.png">
                    <h2>Level Oil</h2>
                    </div>
          <div class="count_bar flex_row center">
                <h1 id="level_oil">1.5</h1>
                <h3>.li</h3>
            </div>
            </div>
            <div class="item flex_column center">
                <div class="item_title_bar flex_row center">
                    <img class="icon" src="icon/wind.png">
                    <h2>Temp Air</h2>
                </div>
            <div class="count_bar flex_row center">
                <h1 id="temp_air">50</h1>
                <h3>.c</h3>
            </div>
            </div>
        </div>
    <div class="management">
        <div class="notification flex_column center">
            <div class="data flex_row center">
                <img class="icon" src="icon/list.png">
                <h1 style="font-family: APEX;">STATUS</h1>
            </div>
            <div class="notif_item_box flex center gap_10">
                <div class="flex_column gap ">
                    <div class="notif_box flex_row align gap_10">
                        <div class="dot_margin dot" style="background-color: orange;"></div>
                        <h4>message</h4>
                    </div>
                    <div class="notif_box flex_row align gap_10">
                        <div class="dot_margin dot" style="background-color: red;"></div>
                        <h4>sim ok</h4>
                    </div>
                    <div class="notif_box flex_row align gap_10">
                        <div class="dot_margin dot" style="background-color: yellowgreen"></div>
                        <h4>message</h4>
                        </div>    
                </div>
                <div class="flex_column gap margin_item">
                    <div class="notif_box flex_row align gap_10">
                        <div class="dot_margin dot" style="background-color:darkmagenta;"></div>
                        <h4>charge</h4>
                    </div>
                    <div class="notif_box flex_row align gap_10">
                        <div class="dot_margin dot" style="background-color:lightseagreen;"></div>
                        <h4>call notif</h4>
                    </div>
                    <div class="notif_box flex_row align gap_10">
                        <div class="dot_margin dot" style="background-color:lightcoral;"></div>
                        <h4>password</h4>
                    </div>    
                </div>
                <div class="flex_column gap">
                    <div class="notif_box flex_row align gap_10 ">
                        <div class="dot_margin dot" style="background-color:brown;"></div>
                        <h4>message</h4>
                    </div>
                    <div class="notif_box flex_row align gap_10">
                        <div class="dot_margin dot" style="background-color:cornflowerblue;"></div>
                        <h4>sim ok</h4>
                    </div>
                    <div class="notif_box flex_row align gap_10">
                        <div class="dot_margin dot" style="background-color: gold;"></div>
                        <h4>message</h4>
                    </div>    
                </div>
        </div>
    </div>
   
        <div class="runtime zero_margin flex_column center">
        <div class="flex_row heigth">
         <img class="control_icon" src="icon/time.png">
        <h2>Run Time</h2>
        
        </div>
        <div class="count_bar flex_row center">
           <h1 id="runtime_value">23</h1>
           <h3>.min</h3>
        </div>
        </div>
        <div class="battery flex_column center">
        <div class="flex_row heigth">
        <img src="icon/battery.png" class="control_icon">
        <h2>Battrey</h2>
        
        </div>
        <div class="count_bar flex_row center">
           <h1 id="voltage_battery_value">50</h1>
           <h3>.volt</h3>
        </div>
        </div>
        
        <div class="control flex_column center">
            <button type="button"  class="mode flex center"><img class="img_mode control_icon"  src="icon/moon.png" ></button>
            <button type="button"  id="message_test" class="flex center"><img  class="control_icon" src="icon/message.png"></button>
            <button type="button"  id="call_test" class="flex center"><img class="control_icon" src="icon/phone.png"></button>
            <button type="button"  id="reset_runtime" class="flex center"><img class="control_icon" src="icon/check_mark.png"></button>
       
        </div>
        <div class="noting"></div>
    </div>
    <!-- setting -->
    <div class="setting_p _page flex_column align ">
            <div class="set_box flex_row align">
               <div id="wifi" class="end selector flex center"><h2>WIFI</h2></div>
               <div id="gsm" class="end selector flex center"><h2>GSM</h2></div>
               <div id="user" class="end selector flex center"><h2>USER</h2></div> 
            </div>
            <div id="wifi_menu" class="main_setting flex_column center">
                <label for="ssid">WIFI NAME</label><br>
                <input class="input" type="text" id="ssid" name="ssid"><br>
                <label for="password">password</label><br>
                <input class="input" type="password" id="password" name="password">
                <button class="accept" type="button">Accept</button>
            </div>
            <div id="gsm_menu" class="main_setting flex_column center" style="background-color: rgb(43, 34, 97);">
                <label for="ssid">Key word</label><br>
                <input class="input" type="text" id="ssid" name="ssid"><br>
                <label for="password">password</label><br>
                <input class="input" type="password" id="password" name="password">
                <button class="accept" type="button">Accept</button>
            </div>
            <div id="user_menu" class="main_setting" style="background-color: blueviolet;"></div>
    </div>
    <!-- profile -->
    <div class="profile_p _page flex_column align">
        <h1 style="font-size: 80px;">Hi dear welcome to unix</h1>
        <div class="shell">
            <h2>USAR NAME : <p3 style="color: blue;">ALI478QWE</p3></h2>
            <h2>WIFI NAME : <p3 style="color: GREEN;">C++</p3></h2>
            <h2>WIFI PAS: <p3  style="color: blue;">C++<p3 style="color: yellow;">(eye)</h3></h3></h2>
            <h2>gsm key : <p3 style="color: rgb(117, 255, 117);">C++</p3></h2>
            <h2>gsm PAS: <p3  style="color: rgb(143, 143, 255);">C++<p3 style="color: rgb(95, 95, 55);">(eye)</h3></h3></h2>
            <h2 style="color: orange;">(: <p3 style="color: rgb(117, 255, 117);">developed by ALI478QWE</p3></h2>
        </div>
    </div>

   <!-- javascript -->

    <script src="toggle.js"></script>
    <script>
        const button_profile = document.querySelector(".profile");
        const button_setting = document.querySelector(".setting_icon");
        const button_mode = document.querySelector(".mode");
        const img_mode = document.querySelector(".img_mode");
        const wifi = document.getElementById("wifi");
        const gsm = document.getElementById("gsm");
        const user = document.getElementById("user");

        function theme() {
            // document.body.style.backgroundColor = this.isOn ? "#F8FAFC" :"#222831" ;
            document.documentElement.classList.remove("light", "dark");
            document.documentElement.classList.add(this.isOn ? "light" :"dark");
            img_mode.src = this.isOn ?  "icon/moon.png":"icon/sun.png" ;
            localStorage.setItem("dark_mode",this.isOn ? "true" : "false");
       
        }


       const mode = new toggle(true, theme, button_mode);
       mode.click();
       const last_mode  = localStorage.getItem("dark_mode") === "true";
       mode.reload(last_mode);

       const buttons = [wifi,gsm, user];
       const menu = ["wifi_menu","gsm_menu","user_menu"];

       function activate(activeBtn,active_menu) {
         for(let x in buttons){
            buttons[x].style.backgroundColor = "black";
         }
         for(let i in menu){
           document.getElementById(menu[i]).style.visibility = "hidden";
            document.getElementById(menu[i]).style.display = "none";
        }
        document.getElementById(active_menu).style.visibility = "visible";
        document.getElementById(active_menu).style.display = "flex";
        
        activeBtn.style.backgroundColor = "red";
        }
        activate(wifi,"wifi_menu");
        button("wifi", () => {activate(wifi,"wifi_menu")});
        button("gsm",  () => {activate(gsm,"gsm_menu")});
        button("user",  () => {activate(user,"user_menu")});

        function click_setting(){
            document.querySelector(".setting_p").style.display = this.isOn ? "flex" : "none";
        }
        const setting = new toggle(true,click_setting,button_setting);
        setting.click();
        setting.reload();

        function click_profile(){
            document.querySelector(".profile_p").style.display = this.isOn ? "flex" : "none";
        }
        const profile = new toggle(true,click_profile,button_profile);
        profile.click();
        profile.reload();

        function updateUI(data) {
                document.getElementById("level_oil").innerText = data.level_oil;
                document.getElementById("temp_oil").innerText = data.temp_oil;
                document.getElementById("temp_air").innerText = data.temp_air;
                document.getElementById("voltage_battery").innerText = data.voltage_battery;
                document.getElementById("runtime_value").innerHTML = dtat.runtime; 
        }

        const socket = new WebSocket("ws://192.168.4.1/ws");

        
        socket.addEventListener("open", () => {
            console.log("Connected to ESP32 WebSocket");
        });

        const message_test = button("message_test" , ()=>{socket.send("message_test");});
        const test_call = button("call_test" , ()=>{socket.send("call_test");}); 
        const reset_runtime = button("reset_runtime" , ()=>{socket.send("reset_runtime");});
 
         document.getElementById("message_test").addEventListener("click", ()=>{socket.send("message_test");});

    
        socket.addEventListener("message", (event) => {
            console.log("Data received from ESP32:", event.data);
            try {
                const json = JSON.parse(event.data);
                updateUI(json);
            } catch (e) {
                console.error("Invalid JSON", e);
            }
        });


        socket.addEventListener("close", () => {
            console.log("WebSocket closed");
        });

    </script>
    </body>
</html>